import mysql.connector

# GLOBAL VARIABLES DECLARATION
myConnnection = ""
cur = ""
userName = ""
password = ""
mid = ""
eid = ""
db = ""
avgloss = ""
dataloss = ""
threat = ""

# MODULE TO CHECK MYSQL CONNECTIVITY
def mysqlconnectioncheck():
    global cur
    global myConnection
    global userName
    global password
    global db
    userName = input("\n ENTER MYSQL SERVER'S USERNAME : ")
    password = input("\n ENTER MYSQL SERVER'S PASSWORD : ")
    db = input("\n ENTER MYSQL SERVER'S DATABASE : ")

    myConnection = mysql.connector.connect(host="localhost", user=userName, passwd=password,database=db,
                                           auth_plugin='mysql_native_password')
    if myConnection:
        print("\n CONGRATULATIONS ! YOUR MYSQL CONNECTION HAS BEEN ESTABLISHED !")
        cur = myConnection.cursor()
        return cur
    else:
        print("\nERROR ESTABLISHING MYSQL CONNECTION CHECK USERNAME AND PASSWORD !")


# MODULE TO ESTABLISHED MYSQL CONNECTION
def mysqlconnection():
    global userName
    global password
    global myConnection

    myConnection = mysql.connector.connect(host="localhost", user=userName, passwd=password, database=db,
                                           auth_plugin='mysql_native_password')
    if myConnection:
        return myConnection
    else:
        print("\nERROR ESTABLISHING MYSQL CONNECTION !")
    myConnection.close()


# MODULE TO CREATE NEW Employee
def newemp():
    global eid
    global cur
    if myConnection:
        cur = myConnection.cursor()
        create_table = """CREATE TABLE IF NOT EXISTS EMPLOYEE(EID VARCHAR(10) PRIMARY KEY ,ENAME VARCHAR(30) NOT NULL ,
        ADDRESS VARCHAR(30)NOT NULL ,PHONE VARCHAR(12) NOT NULL) """
        cur.execute(create_table)
        print("\nPlease Fill All The Information Carefully !")
        eid = input("Please Enter Employee ID : ")
        ename = input("Please Enter Employee Name : ")
        address = input("Please Enter Employee Address : ")
        phone = input("Please Enter Employee Contact No. : ")
        sql = 'INSERT INTO Employee values(%s,%s,%s,%s)'
        values = (eid, ename, address, phone)
        cur.execute(sql, values)
        cur.execute("COMMIT")
        cur.close()
        print("\nNew Employee Added Successfully !")


# MODULE TO DISPLAY EMPLOYEE INFORMATION :
def displayallemployee():
    global cur
    if myConnection:
        cur = myConnection.cursor()
        cur.execute("SELECT * FROM EMPLOYEE")
        data = cur.fetchall()
        if data:
            print("\n**DETAILS OF ALL EMPLOYEE**")
            print(data)
        else:
            print("Sorry ! No Record Found , Please Try Again ! ")
    else:
        print("\nERROR ESTABLISHING MYSQL CONNECTION !")


# MODULE TO SEARCH A EMPLOYEE
def searchemployee():
    global eid
    global cur
    if myConnection:
        cur = myConnection.cursor()
        eid = input("Please Enter EMPLOYEE ID : ")
        sql = "SELECT * FROM EMPLOYEE WHERE EID = %s"
        values = (eid,)
        data = cur.execute(sql, values)
        data = cur.fetchall()
        if data:
            print("\n**EMPLOYEE DETAILS**")
            print(data)
        else:
            print("Sorry ! EMPLOYEE NOT Found , Please Try Again ! ")
    else:
        print("\nSomthing Went Wrong ,Please Try Again !")


# MODULE TO CREATE NEW MALWARE
def newmalware():
    global mid
    global cur
    global eid
    if myConnection:
        cur = myConnection.cursor()
        create_table = """CREATE TABLE IF NOT EXISTS MALWARE(MID VARCHAR(10) PRIMARY KEY ,CVE_ID VARCHAR(20), MNAME VARCHAR(30) NOT NULL, M_DATE DATE NOT NULL ,
        EID VARCHAR(10)) """
        cur.execute(create_table)
        print("\nPlease Fill All The Information Carefully !")
        mid = input("Please Enter Malware ID : ")
        cveid = input("Please Enter CVE ID : ")
        mname = input("Please Enter Malware Name : ")
        date = input("Please Enter Date (YYYY-MM-DD): ")
        eid = input("Please Enter EMPLOYEE ID : ")
        sql = 'INSERT INTO MALWARE values (%s,%s,%s,%s,%s)'
        values = (mid, cveid, mname, date, eid)
        cur.execute(sql, values)
        cur.execute("COMMIT")
        cur.close()
        print("\nNew Malware Info Added Successfully !")

# MODULE TO CREATE ADDITIONAL MALWARE DETAILS
def newmalinfo():
    global mid
    global cur
    global eid
    global avgloss
    global dataloss
    global threat

    if myConnection:
        cur = myConnection.cursor()
        create_table = """CREATE TABLE IF NOT EXISTS MAL_INFO(MID VARCHAR(10) PRIMARY KEY, AFFECTED_PC INT NOT NULL, AVGLOSS VARCHAR(10), 
        DATALOSS VARCHAR(10), THREATRATING VARCHAR(10)) """
        cur.execute(create_table)
        print("\nPlease Fill All The Information Carefully !")
        mid = input("Please Enter Malware ID : ")
        affect = input("Please Enter No. of PC's affected : ")
        avgloss = input("Please Enter Average cost loss (in rupees) : ")
        dataloss = input("Please Enter any Sensitive Data Loss : ")
        threat = input("Please Enter Threat Factor (EXTREME, HIGH, MEDIUM, LOW) : ")
        sql = 'INSERT INTO MAL_INFO values (%s,%s,%s,%s,%s)'
        values = (mid, affect, avgloss, dataloss, threat)
        cur.execute(sql, values)
        cur.execute("COMMIT")
        cur.close()
        print("\nAdditional Malware Info Added Successfully !!")


# MODULE TO DISPLAY MALWARE INFORMATION :
def displayallmalware():
    global cur
    if myConnection:
        cur = myConnection.cursor()
        cur.execute("SELECT * FROM MALWARE")
        data = cur.fetchall()
        if data:
            print("\n**DETAILS OF ALL MALWARE**")
            print(data)
        else:
            print("Sorry ! No Record Found , Please Try Again ! ")
    else:
        print("\nERROR ESTABLISHING MYSQL CONNECTION !")


# MODULE TO SEARCH A MALWARE
def searchmalware():
    global mid
    global cur
    if myConnection:
        cur = myConnection.cursor()
        mid = input("Please Enter Malware ID : ")
        sql = "SELECT * FROM MALWARE WHERE MID = %s"
        values = (mid,)
        data = cur.execute(sql, values)
        data = cur.fetchall()
        if data:
            print("\n**MALWARE DETAILS**")
            print(data)
        else:
            print("Sorry ! MALWARE NOT Found , Please Try Again ! ")
    else:
        print("\nSomthing Went Wrong ,Please Try Again !")


# MODULE TO SEARCH A MALWARE USING EID
def searchmalwareeid():
    global mid, eid
    global cur
    if myConnection:
        cur = myConnection.cursor()
        eid = input("PLEASE ENTER EMPLOYEE ID : ")
        sql = "SELECT * FROM MALWARE WHERE EID = %s"
        values = (eid,)
        data = cur.execute(sql, values)
        data = cur.fetchall()
        if data:
            print("\n**MALWARE DETAILS**")
            print(data)
        else:
            print("Sorry ! Account Infromation NOT Found , Please Try Again ! ")
    else:
        print("Somthing Went Wrong ,Please Try Again !")


# MODULE TO SEARCH A MALWARE USING CVE_ID
def searchmalwarecve():
    global mid
    global cur
    if myConnection:
        cur = myConnection.cursor()
        cevid = input("PLEASE ENTER CVE ID : ")
        sql = "SELECT * FROM MALWARE WHERE CVE_ID = %s"
        values = (cevid,)
        data = cur.execute(sql, values)
        data = cur.fetchall()
        if data:
            print("\n**MALWARE DETAILS**")
            print(data)
        else:
            print("Sorry ! Account Infromation NOT Found , Please Try Again ! ")
    else:
        print("Somthing Went Wrong ,Please Try Again !")

# MODULE TO PRINT ALL INFORMATION USING JOIN
def join():
    global cur
    if myConnection:
        cur = myConnection.cursor()
        sql = "SELECT * FROM EMPLOYEE NATURAL JOIN MALWARE NATURAL JOIN MAL_INFO"
        data = cur.execute(sql)
        data = cur.fetchall()
        if data:
            print("\n**DETAILS USING JOIN OPERATION**")
            print(data)
        else:
            print("Sorry ! MALWARE NOT Found , Please Try Again ! ")
    else:
        print("\nSomthing Went Wrong ,Please Try Again !")

# MODULE TO DELETE A MALWARE
def delmal():
    global mid
    global cur
    if myConnection:
        cur = myConnection.cursor()
        mid = input("PLEASE ENTER MALWARE ID : ")
        sql = "DELETE FROM MALWARE WHERE MID = %s"
        values = (mid,)
        data = cur.execute(sql, values)
        data = cur.fetchall()
        sql = "DELETE FROM MAL_INFO WHERE MID = %s"
        values = (mid,)
        data = cur.execute(sql, values)
        data = cur.fetchall()
        if data:
            print("\n**DELETION UNSUCCESSFUL**")
            print(data)
        else:
             print("\n**DELETION SUCCESSFUL!!**")
    else:
        print("Somthing Went Wrong ,Please Try Again !")

# MODULE TO PROVIDE HELP FOR USER
def helpme():
    print("Please, Visit The Offcial Website Of CyberPrime To Download The Mannual !!!\nFollow the instructions Carefully!!\nDo Enter the inputs properly!")


# MAIN SCREEN
print("********* Amrita School of Computing *****")
print("*********CYBER MALWARE SAFETY SYSTEM ******")
print("***Designed and Maintained By:")
print("***JAYARAJ - CSE-CYS - ROLL NO - CH.EN.U4CYS21026")
print("***KURALAMUDHAN - CSE-CYS - ROLL NO - CH.EN.U4CYS21033")
print("***GOKKULAMOORTHY - CSE-CYS - ROLL NO - CH.EN.U4CYS21019")
print("***DINAKAR - CSE-CYS - ROLL NO - CH.EN.U4CYS21013")
print("***GOWTHAM NIKIL - CSE-CYS - ROLL NO - CH.EN.U4CYS21020")

# STARTING POINT OF THE SYSTEM
myConnection = mysqlconnectioncheck()
if myConnection:
    mysqlconnectioncheck()
    while 1:
        print("\n!=========================*****=======================!")
        print("! PLEASE ENTER 1 FOR NEW EMPLOYEE !")
        print("! PLEASE ENTER 2 TO DISPLAY ALL EMPLOYEE !")
        print("! PLEASE ENTER 3 TO SEARCH AN EMPLOYEE !")
        print("! PLEASE ENTER 4 TO CREATE NEW MALWARE INFO !")
        print("! PLEASE ENTER 5 TO WRITE ADDTIONAL MALWARE INFO !")
        print("! PLEASE ENTER 6 TO DISPLAY ALL MALWARE INFO !")
        print("! PLEASE ENTER 7 TO SEARCH A MALWARE INFO !")
        print("! PLEASE ENTER 8 TO SEARCH A MALWARE INFO USING EMPLOYEE ID !")
        print("! PLEASE ENTER 9 TO SEARCH A MALWARE INFO USING CEV ID !")
        print("! PLEASE ENTER 10 TO DELETE A MALWARE !")
        print("! PLEASE ENTER 11 TO VIEW ENTIRE DATABASE !")
        print("! PLEASE ENTER 12 TO EXIT !")
        print("! PLEASE ENTER 0 FOR HELP !")
        print("\n!============================**END**====================!")
        choice = int(input("\n Please Enter Your Choice : "))
        if choice == 1:
            newemp()
        elif choice == 2:
            displayallemployee()
        elif choice == 3:
            searchemployee()
        elif choice == 4:
            newmalware()
        elif choice == 5:
            newmalinfo()
        elif choice == 6:
            displayallmalware()
        elif choice == 7:
            searchmalware()
        elif choice == 8:
            searchmalwareeid()
        elif choice == 9:
            searchmalwarecve()
        elif choice == 10:
            delmal()
        elif choice == 11:
            join()
        elif choice == 12:
            break
        elif choice == 0:
            helpme()
        else:
            print("Sorry ,May Be You Are Giving Me Wrong Input, Please Try Again !!! ")

    # END OF THE PROJECT
